<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>4í•™ë…„ 4ë°˜ ë¸”ë¡œê·¸</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: white;
      color: black;
      transition: 0.3s;
    }
    body.dark-mode {
      background: #121212;
      color: #e0e0e0;
    }
    input, textarea, select {
      display: block;
      margin-bottom: 10px;
      width: 300px;
    }
    button {
      margin: 5px 5px 5px 0;
    }
    .hidden { display: none; }
    ul { list-style-type: none; padding: 0; }
    li { border-bottom: 1px solid #ccc; padding: 10px 0; }
    .comment { margin-left: 20px; font-size: 0.9em; color: #555; }
  </style>
</head>
<body>

  <h1>ğŸ“š 4í•™ë…„ 4ë°˜ ë¸”ë¡œê·¸</h1>

  <!-- íšŒì›ê°€ì… -->
  <div id="signup-section">
    <h3>íšŒì›ê°€ì… (í•™ìƒë§Œ ê°€ëŠ¥)</h3>
    <input id="signup-username" placeholder="ì•„ì´ë””">
    <input id="signup-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button type="button" onclick="signup()">íšŒì›ê°€ì…</button>
  </div>

  <!-- ë¡œê·¸ì¸ -->
  <div id="login-section">
    <h3>ë¡œê·¸ì¸</h3>
    <input id="login-username" placeholder="ì•„ì´ë””">
    <input id="login-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button type="button" onclick="login()">ë¡œê·¸ì¸</button>
  </div>

  <!-- ë¡œê·¸ì¸ í›„ -->
  <div id="user-section" class="hidden">
    <p><strong id="user-info"></strong>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</p>
    <button type="button" onclick="toggleWrite()">âœï¸ ê¸€ì“°ê¸°</button>
    <button type="button" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    <button type="button" onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
  </div>

  <!-- ê¸€ì“°ê¸° -->
  <div id="write-area" class="hidden">
    <input id="post-title" placeholder="ì œëª©">
    <textarea id="post-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
    <label><input type="checkbox" id="is-announcement"> ì „ì²´ ê³µì§€</label>
    <button type="button" onclick="submitPost()">ì‘ì„± ì™„ë£Œ</button>
  </div>

  <h2>ğŸ“¢ ê³µì§€ì‚¬í•­</h2>
  <ul id="announcements"></ul>

  <h2>ğŸ“ ì „ì²´ ê¸€</h2>
  <ul id="posts"></ul>

<script>
  const adminAccounts = [
    { username: "admin1", password: "1234", role: "ADMIN" },
    { username: "teacherKim", password: "abcd", role: "teacher" }
  ];

  // âœ… ì‚¬ìš©ì ë¡œë”© ë° ê´€ë¦¬ì ê³„ì • ìë™ ë³´ì¡´
  let users = JSON.parse(localStorage.getItem("users") || "[]");
  let updated = false;
  adminAccounts.forEach(admin => {
    if (!users.some(u => u.username === admin.username)) {
      users.push(admin);
      updated = true;
    }
  });
  if (updated) {
    localStorage.setItem("users", JSON.stringify(users));
  }

  let currentUser = null;

  function signup() {
    const username = document.getElementById("signup-username").value.trim();
    const password = document.getElementById("signup-password").value.trim();

    if (!username || !password) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    if (username.startsWith("admin") || username.startsWith("teacher")) {
      return alert("ê´€ë¦¬ì ë˜ëŠ” ì„ ìƒë‹˜ ì•„ì´ë””ë¡œëŠ” ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    users = JSON.parse(localStorage.getItem("users") || "[]");
    if (users.find(u => u.username === username)) {
      return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
    }

    users.push({ username, password, role: "student" });
    localStorage.setItem("users", JSON.stringify(users));
    alert("íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
  }

  function login() {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value.trim();

    users = JSON.parse(localStorage.getItem("users") || "[]");
    const user = users.find(u => u.username === username && u.password === password);
    if (!user) return alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸");

    currentUser = user;
    document.getElementById("user-info").innerText = `${user.username} (${user.role})`;
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("signup-section").classList.add("hidden");
    document.getElementById("user-section").classList.remove("hidden");

    renderPosts();
  }

  function logout() {
    currentUser = null;
    document.getElementById("login-section").classList.remove("hidden");
    document.getElementById("signup-section").classList.remove("hidden");
    document.getElementById("user-section").classList.add("hidden");
    document.getElementById("write-area").classList.add("hidden");
  }

  function toggleWrite() {
    const area = document.getElementById("write-area");
    area.classList.toggle("hidden");
  }

  function submitPost() {
    const title = document.getElementById("post-title").value.trim();
    const content = document.getElementById("post-content").value.trim();
    const isAnnouncement = document.getElementById("is-announcement").checked;

    if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
    if (isAnnouncement && !(currentUser.role === "ADMIN" || currentUser.role === "teacher")) {
      return alert("ê³µì§€ ì‘ì„± ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
    }

    const post = {
      id: Date.now(),
      title,
      content,
      isAnnouncement,
      author: currentUser.username,
      role: currentUser.role,
      timestamp: new Date().toLocaleString(),
      comments: []
    };

    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    posts.unshift(post);
    localStorage.setItem("posts", JSON.stringify(posts));

    document.getElementById("post-title").value = "";
    document.getElementById("post-content").value = "";
    document.getElementById("is-announcement").checked = false;

    renderPosts();
  }

  function addComment(postId, inputId) {
    const commentInput = document.getElementById(inputId);
    const comment = commentInput.value.trim();
    if (!comment) return;

    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    const post = posts.find(p => p.id === postId);
    post.comments.push({ author: currentUser.username, text: comment, time: new Date().toLocaleTimeString() });

    localStorage.setItem("posts", JSON.stringify(posts));
    commentInput.value = "";
    renderPosts();
  }

  function deletePost(postId) {
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    posts = posts.filter(p => !(p.id === postId && p.author === currentUser.username));
    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
  }

  function renderPosts() {
    const posts = JSON.parse(localStorage.getItem("posts") || "[]");
    const postList = document.getElementById("posts");
    const annList = document.getElementById("announcements");
    postList.innerHTML = "";
    annList.innerHTML = "";

    posts.forEach(post => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${post.title}</strong><br>
        ${post.content}<br>
        <small>by ${post.author} (${post.role}) - ${post.timestamp}</small><br>
        ${post.author === currentUser?.username ? `<button type="button" onclick="deletePost(${post.id})">ì‚­ì œ</button>` : ""}
        <input type="text" id="comment-${post.id}" placeholder="ëŒ“ê¸€">
        <button type="button" onclick="addComment(${post.id}, 'comment-${post.id}')">ëŒ“ê¸€ ë‹¬ê¸°</button>
        ${post.comments.map(c => `<div class="comment">ğŸ’¬ ${c.author}: ${c.text} (${c.time})</div>`).join("")}
      `;
      if (post.isAnnouncement) {
        annList.appendChild(li.cloneNode(true));
      } else {
        postList.appendChild(li);
      }
    });
  }

  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
  }
</script>

</body>
</html>
